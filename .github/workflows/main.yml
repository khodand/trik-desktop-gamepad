name: travis-action
env:
  SCRIPTS_PATH: "./workflow_scripts"
  CONFIG: "release"
  VERA: false
  SUFFIX: "" 
  QMAKE_EXTRA: ""
  
on: [push]

jobs:
  Build:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        configs: [release, debug]
        exclude:
        - os: macos-latest
          configs: debug

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v2
    - name: Set enviroment
      run: |
        export CONFIG=$matrix.configs
        export OS_NAME=$runner.os
        export CELLAR_CACHE_DIR=$([ $runner.os = 'macOS' ] && echo "/usr/local/Cellar" || { mkdir -p .empty/{qt,ccache,python@2,python@3} ; echo .empty ; } )
    - name: install
      run: $SCRIPTS_PATH/install.sh
    - name: script
      run: $SCRIPTS_PATH/script.sh
    - name: after_script
      run: $SCRIPTS_PATH/after_script.sh
    - name: after_success
      run: if [ "$CONFIG" = "debug" ]; then codecov; fi
      
